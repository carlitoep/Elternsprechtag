# ======== Stage 1: Build ========
FROM gradle:8.2-jdk21 AS builder

WORKDIR /home/gradle/project

# Projektdateien kopieren
COPY build.gradle settings.gradle gradlew ./
COPY gradle ./gradle
COPY src ./src

# Gradle Wrapper ausführbar machen
RUN chmod +x ./gradlew

# Builden (Tests überspringen)
RUN ./gradlew build -x test

# ======== Stage 2: Run ========
FROM eclipse-temurin:21-jdk-jammy

WORKDIR /app

# Spring Boot JAR vom Build kopieren
COPY --from=builder /home/gradle/project/build/libs/demo-0.0.1-SNAPSHOT.jar ./demo.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "demo.jar"]
